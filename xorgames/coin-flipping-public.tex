%=======================

\section{Option sets of size at most two\texorpdfstring{; the $(\ell, n, \alpha)$-Bernoulli game}{}}

    Let us consider a uniform XOR target game where an option set 
    contains at most two elements. 
    From Definition~\ref{def:xor-game-explicit}, 
    we conclude that in this case, 
    an option set is either $\{\star\}$ 
    or $\{0^\kappa, s\}$ where $s$ is uniform in $\{0,1\}^\kappa$.


    \begin{definition}[$(\ell, n, \alpha)$-Bernoulli game]
        \label{def:static-game}\label{def:Bernoulli-game}
        Let $\alpha \in (0, 1/2)$. 
        Let $\Bernoulli(\alpha)$ denote the distribution of a Bernoulli random variable 
        $B \in \{0,1\}$ where $\Pr[B = 1] = \alpha$.
        An $(\ell, n, \Bernoulli(\alpha))$-game 
        is called the \emph{$(\ell, n, \alpha)$-Bernoulli game}.
    \end{definition}
    The following is an immediate corollary from Theorem~\ref{thm:xor-game-lookahead}.

    \begin{theorem}\label{thm:xor-game-playornot}
        Let $\alpha \in (0, 1/2)$ and $\lambda \in (0, \log_2(1/\alpha)]$. 
        Let $U$ be an $(\ell, n, \alpha)$-Bernoulli game. 
        Let $g$ be the grinding power of $U$. 
        Let $A$ be the event that 
        at least one of the option sets $P_{\ell + i}, i \in [n]$ is $\{\star\}$; 
        condition on $A$. 
        Then 
        $$
            \Exp [g^\lambda \mid A] \leq 2^{\lambda(\ell + 1)} n/(1+\alpha)
            \,.
        $$
    \end{theorem}

    % \begin{lemma}[Grinding power moments in the $(\ell, n, \alpha)$-Bernoulli game]
    % \label{lemma:xor-game-bernoulli-moment}
    % \end{lemma}
    \begin{proof}
        We retrace the proof of Lemma~\ref{lemma:adaptive-moment} 
        using $S = B$ and $r_i = 1 - B_i, i \in [\ell + n]$; 
        hence $|P_i| = 1 + B, i \in [\ell + n]$. 
        In particular, the random variables $H, r_i, i \in [\ell + n]$ 
        and the 
        events $A, A_h, h \in [n]$ remain the same. 
        % Let $H \defeq \max \{i : \text{$i \in [\ell+1, \ell+n]$ and $B_i = 0$} \}$. 
        % By our assumptions, $H \in [\ell+1, \ell+n]$ is well-defined, 
        % at least one of the $B_i$s is zero, and hence, 
        % the leading product in~\eqref{eq:xor-game-lookahead-gp} 
        % vanishes. 
        % Condition on the event $H = h$; 
        % this means $B_{\ell + h} = 0$ and 
        % $B_i = 1$ for $i \geq \ell + h+1$. 
        % Thus the additive terms for $k \leq h - 1$ 
        % in~\eqref{eq:xor-game-lookahead-gp}
        % vanishes as well.
        % Since $|P_i| \in \{1, 2\}$, 
        % the expression in~\eqref{eq:xor-game-lookahead-gp} becomes 
        Thus $\beta = 1 - \alpha$ and 
        $\Pr[H = h] = (1 - \alpha) \alpha^{n - h}$ for $h \in [n]$. 
        Condition on $A_h$. 
        Since $1 + S \leq 2$ and $|P_i| = 2$ for $i \geq \ell + h + 1$, 
        we can upper bound the right-hand side in~\eqref{eq:ell-n-d-game-bound-gh} as 
        \begin{align*}
        % \label{eq:xor-game-playornot-gp}
            g_h
            &\leq (1 + B)^\ell \sum_{k = h}^n 2^{n - k}
            % \sum_{k=h}^n (1 - B_k) \, 
            %     \left(  \prod_{i=k}^{\ell+k-1}      (1 + B_i)   \right)   
            %     \left(  \prod_{i=\ell+k+1}^{\ell+n} 2 B_i       \right)    
            %     \\        
            % &\leq 
            %     \sum_{k=h}^{n }
            %     (1 - B_k)\,
            %     2^\ell\,
            %     2^{n - k}            
            \leq 
                2^{\ell} \cdot ( 1 + 2 + \cdots + 2^{n - h} ) 
            = 2^{n + \ell - h + 1}
        \,.
        \end{align*}
        It follows that
        $
            \Exp [g_h^\lambda \mid A_h]
            \leq 
                2^{\lambda(n + \ell - h + 1)} 
        $ 
        since 
        the quantities $|P_{i}|$ in the game $U$ are independent. 
        Since $\Pr[A] = 1 - \alpha^n$, we have 
        \begin{align*}
            \Exp [g^\lambda \mid A]
                &=
                \sum_{h = 1}^n \Pr[A_h \mid A] 
                    \Exp [g_h^\lambda \mid A_h] 
                =
                \sum_{h = 1}^n 
                    \frac{(1 - \alpha) \alpha^{n-h}}{1 - \alpha^n}\,
                    \Exp [g_h^\lambda \mid A_h] 
                \leq 
                    \frac{2^{\lambda(\ell + 1)}}{1+\alpha}
                    \sum_{h=1}^n 
                    \left( \alpha 2^\lambda \right)^{n-h} 
        \end{align*}
        since $(1 - \alpha)/(1 - \alpha^n) \leq 1/(1 + \alpha)$ for any $n \geq 2$. 
        By assumption, $\lambda \leq \log_2(1/\alpha)$ or, 
        equivalently, $\alpha 2^\lambda \leq 1$.
        It follows that 
        $
            \Exp [g^\lambda \mid A] \leq  n \cdot 2^{\lambda(\ell + 1)}/(1+\alpha)
        $.
    \end{proof}


    \begin{lemma}\label{lemma:xor-game-Bernoulli-gamma}
        Let $\EpsP \in (0,1), \ell, n \in \NN, n \geq 2$ and 
        $\alpha \in (0, 1/2)$.
        Let $U$ be a $(\ell, n, \alpha)$-Bernoulli game. 
        The grinding power $g = g(U)$ 
        satisfies $\Pr[g \geq \gamma] \leq \alpha^n + \EpsP$ where 
        \begin{align}\label{eq:bernoulli-game-gamma}
            % {\gamma = n 2^{\ell+1 + q/\log_2(1/\alpha)}}
            \gamma = 2^{\ell + 1} \left(
                \frac{n}{(1+\alpha)\EpsP}
            \right)^{1/\log_2(1/\alpha)}
            % \quad\text{and}\quad q = \log_2(1/\EpsP)
            \,.
        \end{align}
    \end{lemma}
    \begin{proof}
        Let $\gamma$ be a positive integer whose value will be set later.
        Let $A$ be the event that 
        at least one of the option sets $P_{\ell + i}, i \in [n]$ in $U$ is $\{\star\}$. 
        (Note that $\Pr[\overline{A}] = \alpha^n$.)
        Theorem~\ref{thm:xor-game-playornot} states that 
        for any $\lambda \in (0, \log_2(1/\alpha)]$, 
        $\Exp [g^\lambda \mid A]$ is at most $n 2^{\lambda(\ell + 1)}$. 
        Since $g$ is non-negative, 
        Markov's inequality implies that 
        $$
        \Pr[g \geq \gamma] 
        \leq \Pr[\overline{A}] + \Pr[g \geq \gamma | A]
        \leq \alpha^n  + \Exp[g^\lambda \mid A]/\gamma^\lambda
        \leq \alpha^n  + \frac{n}{1+\alpha} 
            \left(\frac{2^{\ell + 1}}{\gamma}\right)^\lambda
        \,.$$ 
        Writing $a = 2^{\ell + 1}/\gamma$, 
        the derivative of this upper bound with respect to $\lambda$ is 
        $n a^\lambda \ln(a) / (1+\alpha)$ . 
        This quantity is non-positive as long as $a \leq 1$ or, equivalently, 
        $\gamma \geq 2^{\ell + 1}$. 
        Thus we get the tightest upper bound on $\Pr[g \geq \gamma]$ 
        by taking the largest permitted value of $\lambda$ 
        as long as $\gamma$ is at least $2^{\ell + 1}$. 
        
        Set $\lambda = \log_2(1/\alpha)$ and take any $\EpsP \in (0,1)$. 
        For any real positive $x$, 
        the inequality $(n/(1+\alpha)) (2^{\ell + 1}/x)^\lambda \leq \EpsP$ 
        is equivalent to saying that 
        $x \geq 2^{\ell + 1} (n/(1+\alpha)\EpsP)^{1/\log_2(1/\alpha)}$. 
        Let us take 
        $\gamma \defeq 2^{\ell + 1} (n/(1+\alpha)\EpsP)^{1/\log_2(1/\alpha)}$ 
        so that this inequality is satisfied by setting $x = \gamma$. 
        This implies two things. 
        First, 
        since $\alpha > 0, \EpsP < 1$, and $n \geq 2$, 
        the quantity  $(n/(1+\alpha)\EpsP)^{1/\log_2(1/\alpha)}$ is at least one and, consequently, 
        $\gamma$ is clearly larger than $2^{\ell + 1}$. 
        Second, 
        the quantity 
        $\left( \Exp[g^\lambda | A]/\EpsP \right)^{1/\lambda}$ is at most $\gamma$ 
        and, using Fact~\ref{fact:grinding-max}, 
        $\Pr[g \geq \gamma | A]$ is at most $\EpsP$. 
        It follows that $\Pr[g \geq \gamma] \leq \alpha^n + \EpsP$.
    \end{proof}


\section{Proof of Theorem~\ref{thm:beacon-Bernoulli} }

\begin{theorem}\label{thm:beacon-Bernoulli}
  Let $\tau, a \in \RR_+, a > 1, \tau \in (0, \infty)$. 
   % and $\EpsP = 2^{-\tau}$. 
  Let $d, k, T \in \NN$ 
  so that $d$ divides both $k$ and $T$ and, 
  writing $n = (T - k)/d$ and $\ell = k/d$, 
  satisfy $a n \geq \tau$.
  Set $\alpha = 2^{-a}$ and 
  suppose that the coin-flipping protocol $\Pi = \CoinTossingPublic$ 
  uses a $(2^{-\tau}, k)$-secure ledger protocol $\Blockchain$.
  An $(L, \Pi)$-composition is $(3 L n \epsilon, \rho)$-secure where
  $$
    \epsilon = 2^{- \tau(1 - 1/a) + \ell + 1}
    \quad\text{and} \quad
    \rho = \ell + \log_2 n + \tau/a + 1
    \,.
  $$
  % $
  %   p 
  %   % = 3 L \EpsP 2^\rho
  %   % = 3 L 2^{\rho - \tau}
  %   = 3 L 2^{- \tau(1 - 1/a) + \ell + \log_2 n + 1}
  %   % \,.
  % $ and 
  % $\rho = \ell + \log_2 n + \tau/a + 1$.
\end{theorem}
\begin{proof}[(Proof sketch)]
  Apply  
  Lemma~\ref{lemma:xor-game-Bernoulli-gamma} into 
  Lemma~\ref{lemma:composition}.
\end{proof}
