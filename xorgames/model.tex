

In this \Section\,, we formally expand the ideas mentioned before 
and lay the groundwork for our new beacons. 
We start by describing a ``nonce channel'' which guarantees that 
every honest nonce inputs will contribute to the beacon output, 
i.e., they cannot be bypassed. 
Next, we formally describe our beacon protocol $\Pi_\Beacon$ 
then state the security guarantees against both an adaptive adversary 
and a static adversary. 
The first setting is relevant to Praos (private leader election) 
and the second setting 
is relevant to Ouroboros classic (public leader election). 
The proofs of the main theorems appear in \Section~\ref{sec:main-thm-proofs}.


\section{Nonce leaders and the nonce channel}
Recall the private and public lottery-based leader election schemes 
from Section~\ref{sec:static-dynamic-adversary}. 
Consider a beacon protocol of dimension $\kappa$, 
i.e., one where the initial values and the outputs are $\kappa$-bit Boolean strings. 
Inside an epoch, 
the participants $\Players$ take part in the \emph{nonce leader election}. 
If a player is elected a nonce leader, 
he emits a uniformly random string from $\{0,1\}^\kappa$  
in the \emph{nonce channel}. 

\begin{definition}[Nonce channel with parameter $k \in \NN$]\label{def:nonce-channel}
  Messages announced in the nonce channel is a tuple $m = (u, x, i, j)$ 
  which reads ``player $u$ is submitting nonce $x$ for slot $i$, 
  and the announcement is made at slot $j$.''
  A nonce message, received at slot $t$, becomes \emph{invalid} 
  if $j > i + k$.
  The nonce channel is a public, immutable ledger: 
  once a valid nonce is announced in this channel, 
  it remains there forever. 
\end{definition}
\noindent
The basic property that we seek from the nonce channel is that 
honest nonces are never lost. 


Notice that the nonce channel can be implemented 
on top of a blockchain protocol $\Blockchain$ 
and mechanisms such as ``input endorsers'' in Ouroboros~\cite{Ouroboros} 
or ``fruits'' in Fruitchain or SnowWhite~\cite{Fruitchains,SnowWhite}.
Here is an example: 
Suppose $\Blockchain$ has the $\sECQ$ property and $\kSlotCP$ property. 
(The validity parameter $k$ in the nonce channel of $\Pi_\Beacon$ 
must match the consistency parameter $k$ in $\Blockchain$.)
Then
\begin{itemize}
  \item A nonce leader in $\Pi_\Beacon$ asks to record his nonce message on $\Blockchain$.
  This announcement is seen (and remembered) by all honest observers in $\Pi_\Beacon$.
  
  \item Suppose an honest observer finds that a valid nonce message he had previously received, 
  does not appear in the ledger implemented by $\Blockchain$. 
  Then he re-announces this message with a proof of this re-announcement.

  \item Eventually, by the persistence guarantee of $\Blockchain$, 
  this message gets recorded in the ledger.
\end{itemize}
\noindent




\newcommand{\PublicElectionDistribution}{\hat{\mathcal{L}}}
\newcommand{\PrivateElectionDistribution}{\mathcal{L}}

\section{The beacon}




\begin{definition}[$(T, k, s, d, \LeaderElection,\EpsP)$-Beacon]\label{def:new-beacon}
  Let $T, k, s,d \in \NN$ and $\EpsP \in (0,1)$ 
  so that $k$ divides $T$.
  Let $\LeaderElection$ be a given leader election mechanism 
  (see Section~\ref{sec:leader-election-public-private}).
  Let $\Blockchain$ be an $(\EpsP, k, s)$-secure blockchain protocol 
  with epoch length at least $T + s + k$. 
  Consider the following simple beacon protocol on $\{0,1\}^\kappa$ 
  that takes place inside every epoch of $\Blockchain$. 
  $\Pi_\Beacon$ operates inside an epoch of $\Blockchain$ 
  and it computes a function 
  $\Pi_\Beacon : \{0,1\}^\kappa \rightarrow \{0,1\}^\kappa$. 
  Given an initial value $x$ before an epoch, 
  it outputs $\Pi_\Beacon(x)$ 
  after the epoch, as follows:
  \begin{itemize}
    \item The first $T$ slots of the epoch participate in $\Pi_\Beacon$. 
    Of these, only one in every $d$ slots is a \emph{nonce-emitting slot}. 

    \item In a nonce-emitting slot, one or more players are elected as a \emph{nonce leader} 
    according to the leader election mechanism $\LeaderElection$.
    A nonce leader announces a uniformly random $\kappa$-bit Boolean string, 
    called a \emph{nonce},  
    in the nonce channel (which has parameter $k$). 

    \item 
    Let $S$ be the set of all nonce-emitting slots in epoch $t$.
    After th epoch is finished, the output $\eta$ is calculated as follows:
    Let $C_i$ be the set of valid nonces recorded from slot $i$ in this epoch. 
    Let $y_i$ be the lexicographically smallest item in $C_i$.
    Finally, we set $\Pi_\Beacon(x) = x \oplus_{i \in S} y_s$.
  \end{itemize}
  Let $\eta_0$ be a uniformly random string in $\{0,1\}^\kappa$. 
  When the beacon is executed for $L$ epochs, 
  the output is a sequential composition of 
  $L$ independent instances of $\Pi_\Beacon$; 
  the output of after epoch $t$ is the initial value used in epoch $(t+1)$. 
  Specifically, 
  the beacon output for epoch $t \in [L]$ is 
  \begin{align}\label{eq:beacon-iterated}
    \eta_t = \Pi_\Beacon(\eta_{t-1}) = \Pi_\Beacon^t(\eta_0)\,.
  \end{align}
\end{definition}






\section{Guarantees against an adaptive adversary}

Let $\alpha \in (0, 1/2), \EpsP \in (0, 1)$ and $T, k, s \in \NN$.
Define 
\begin{align}
    d &= \lfloor (T - k) \log_2(1/\alpha)/\log_2(1/\EpsP)\rfloor \label{eq:d-multiepoch}\\
    f(\alpha) &= \log_2(1 + 3 \alpha + \alpha^2)/\log_2(1/\alpha) \label{eq:f-poisson} \\
    n(\alpha) &= \log_2(1/\EpsP)/\log_2(1/\alpha) \label{eq:f-poisson} 
  %   \\
  % \rho &= 
  %     \frac{k}{2 d} \log_2(1+3\alpha+\alpha^2) 
  %     + \begin{cases}
  %    \frac{1}{2} \log_2 \left[ \frac{(n(\alpha)^3}{(1+\alpha) \EpsP } \right] 
  %     & \quad\text{if $\alpha \leq 0.41$}\,, \\
  %    \frac{f(\alpha)}{2} \log_2 \left[\frac{n(\alpha)^{1 + 2/f(\alpha)} }{(1+\alpha) \EpsP} \right] 
  %     &\quad\text{otherwise}\,.
  %   \end{cases}  \label{eq:rho-poisson-orig} \\
  % \rho &= 
  %     \begin{cases}
  %     \log_2(1/\EpsP) \cdot \left(1 + f(\alpha) k/(T-k) \right)/2
  %       + \frac{1}{2} \log_2 \left[ n(\alpha)^3 /(1+\alpha) \right] 
  %       & \quad\text{if $\alpha \leq 0.41$}\,, \\
  %     \log_2(1/\EpsP) \cdot f(\alpha) \left(1 + k/(T-k) \right)/2
  %       + \frac{f(\alpha)}{2} \log_2 \left[n(\alpha)^{1 + 2/f(\alpha)} /(1+\alpha) \right] 
  %       &\quad\text{otherwise\,.}
  % \end{cases}\label{eq:rho-poisson}
\end{align}
Let us remark that for $\alpha \in (0, 0.41)$, $f(\alpha) \in (0,1)$. 
There will be $T/d$ nonce-emitting slots in an epoch of $\Pi_\Beacon$. 


\begin{theorem}[Adaptive adversary, multiple epochs]\label{thm:beacon-poisson-multi-epoch}
  Let $\alpha \in (0, 0.41), \EpsP \in (0,1)$, 
  and $d$ as in~\eqref{eq:d-multiepoch}. 
  % and suppose that \eqref{eq:alphatothen-epsp} is satisfied with $n = (T-k)/d$.
  % Let $\alpha \in (0, 0.41)$ and $T, s, k, \EpsP, L$ as above. 
  % Let $\lambda$ be defined in~\eqref{eq:lambda-star-poisson} and 
  % let $\gamma$ be defined in~\eqref{eq:xor-poisson-tail-gamma}. 
  Let $f(\alpha)$ be as in \eqref{eq:f-poisson}.
  Let
  \begin{align}
      \rho&= \log_2(1/\EpsP) \cdot \left(1 + f(\alpha) k/(T-k) \right)/2
        + \frac{1}{2} \log_2 \left[ n(\alpha)^3 /(1+\alpha) \right] 
        \,.
        \label{eq:rho-poisson}
  \end{align}
  Let $\Pi_\Beacon$ be a $(T,k,s,d,\PrivateLeaderElection(\alpha), \EpsP)$-beacon.
  Let $\eta$ be the beacon output after $L$ epochs. 
  Then 
  $$
    \Pr_{\PrivateLeaderElection(\alpha)}[\MinEntropy(\eta) \geq \kappa - \rho ] \geq 
      % 1 -  3 L (T - k)^{3/2} \EpsP^{ (1/2) \cdot \left( 1 - f(\alpha)k/(T-k) \right)}
      1 - 3 L (T - k)^{3/2} \EpsP^{1/2 - (k/(T-k)) f(\alpha)/2}
    \,.
  $$
  % Here, the probability is taken according to $\PrivateLeaderElection(\alpha)$.
\end{theorem}

See Figure~\ref{fig:rho-poisson-beacon} for a comparison between 
this beacon and Praos beacon.

\iftoggle{drawfigs}{

\input{xorgames/fig-poisson-beacon}  

}




\section{Guarantees against a static adversary}

Let $\alpha \in (0, 1/2), \EpsP \in (0, 1)$ and $T, k, s, d \in \NN$.
Suppose the above parameters satisfy 
\begin{align}\label{eq:alphatothen-epsp}
  \alpha^{(T-k)/d} \leq \EpsP
  \,.
\end{align}
Define 
\begin{align}
  f(\alpha)&= 1/\log_2(1/\alpha)\,, \label{eq:f-bernoulli} \\
  \rho &= \frac{k}{d} + 1 + f(\alpha) \log_2 \left(\frac{T-k}{d (1+\alpha) \EpsP } \right)
  \,. \label{eq:rho-bernoulli}
\end{align}

\begin{theorem}[Static adversary, multiple epochs]\label{thm:beacon-bernoulli-multi-epoch}
  Let $\alpha \in (0, 0.41)$ and suppose it satisfies \eqref{eq:alphatothen-epsp}.
  Let $f(\alpha)$ and $\rho$ be as in \eqref{eq:f-bernoulli} and \eqref{eq:rho-bernoulli}.
  Let $\Pi_\Beacon$ be a $(T,k,s,d,\PublicLeaderElection(\alpha), \EpsP)$-beacon.
  Let $\eta$ be the beacon output after $L$ epochs. 
  Then 
  \begin{equation}\label{eq:security-bernoulli-multi-epoch}
    \Pr_{\PublicLeaderElection(\alpha)}\left[\MinEntropy(\eta) \geq \kappa - \rho \right] 
      \geq 1 - 3 L
        2^{(k/d) + 1}
        \left( \frac{T-k}{d(1+\alpha)}\right)^{f(\alpha)}
        \EpsP^{1-f(\alpha)}
    \,.
  \end{equation}
\end{theorem}


% \iftoggle{drawfigs}{

% \input{xorgames/fig-bernoulli-beacon}  

% }
\begin{figure}[!htb]
    \centering
    \tikzsetnextfilename{rho-bernoulli}
    \begin{tikzpicture}[trim axis left,
      ]
      \begin{axis}[domain=0:1, 
        xmin=0,xmax=1,ymin=0,%,ymax=2.5
        restrict x to domain=0.01:0.99,
        samples=500,
        enlarge x limits=false,
        grid=both,
        no markers, 
        % legend pos=outer north east,
        legend pos=outer north east,
        legend cell align=left,
        x label style={at={(axis description cs:0.5,-0.1)},anchor=north},
        y label style={at={(axis description cs:-0.1,.5)},anchor=south},
        xlabel={$\epsilon$, honest bias},
        title={$\rho^*$, upper bound on the min-entropy loss $\rho$}
        ]
        \addplot +[ultra thick,red] { BernoulliBeaconMinEntropyLoss(\x, 900, PraosEpsP(\x, 900) ) };
        \addlegendentry{Bernoulli, $k = 900$};
        \addplot +[ultra thick,black] { BernoulliBeaconMinEntropyLoss(\x, 900, PraosEpsP(\x, 1200) ) };
        \addlegendentry{Bernoulli, $k = 1200$};
      \end{axis}
    \end{tikzpicture}%
    \caption{Min-entropy loss in Bernoulli beacon}
    \label{fig:rho-bernoulli-beacon}
\end{figure}




