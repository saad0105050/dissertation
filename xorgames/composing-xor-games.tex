

  % \subsection{Proof of Theorem~\ref{thm:xor-game-private-election}.}





































\section{The Poisson game over multiple epochs}



% Therefore, we cannot achieve both a small $\rho$ and a small $\epsilon$ at the same time. 
% If we wish to give a strong guarantee we have to use a large $\tau$, 
% but the min-entropy loss $\rho$ depends linearly on $\tau$. 

\paragraph{The setup.} 
Let $\tau > 0$ and $\alpha \in (0, 1/2)$ be two reals. 
 % and $\EpsP = 2^{-\tau}$. 
Let $\EpsP \in (0, 1)$. 
Let $d, k \in \NN$ 
so that $d$ divides $k$. 
Let $R \in \NN, T = Rk$ so that 
writing $n = (T - k)/d$ and $\ell = k/d$, 
$\alpha^n$ is at most $\EpsP$. 
Let $\Blockchain$ be an $(\EpsP, k, s)$-secure blockchain protocol 
with epoch length at least $T + s + k$. 
Suppose the	coin-flipping protocol $\Pi = \CoinTossingPrivate$ 
takes place in the first $T$ slots of every epoch. 
That is, the coin-flipping output of an epoch is used 
as the input for the coin-flipping in the next epoch; 
the input to the first epoch is a uniformly random string. 
The parameter $d$ of $\Pi$ is given below.
Let the coin-flipping outcome after $L$ epochs of $\Blockchain$ is $\eta$.

\begin{theorem}\label{thm:beacon-poisson}
	Let $\alpha \in (0, 0.41)$ and $T, s, k, \EpsP, L$ as above. 
	Let $\lambda$ be defined in~\eqref{eq:lambda-star-poisson} and 
	let $\gamma$ be defined in~\eqref{eq:xor-poisson-tail-gamma}. 
	Let 
  \begin{align*}
      \lambda &\ \text{be defined in~\eqref{eq:lambda-star-poisson}}
      \,, \\
      \gamma &\ \text{be defined in~\eqref{eq:xor-poisson-tail-gamma}}
      \,, \\
      d &= \lfloor (T - k) \log_2(1/\alpha)/\log_2(1/\EpsP)\rfloor
      \,,\quad\text{and}\\
      f(\alpha) &= \frac{\ln(1 + 3 \alpha + \alpha^2)}{\ln(1/\alpha)}
      \,.
  \end{align*}
	Then 
	$$
		\MinEntropy(\eta) \geq \kappa - \log_2(\gamma)
  $$
  except with probability 
  $$ 
      3 L (T - k)^{3/2} \EpsP^{1/2 \left( 1 - f(\alpha)k/(T-k) \right)}
		\,.
	$$
	Here, the probability is taken over 
	the leader election mechanism.
\end{theorem}

% \iftoggle{drawfigs}{

\begin{figure}
  \centering
  \pgfmathsetmacro{\k}{900}
  \pgfmathsetmacro{\d}{1}
  \pgfmathsetmacro{\R}{16} % 0.6 * epoch length
  % \pgfmathsetmacro{\T}{\R * \k}
  % \pgfmathsetmacro{\tau}{\k/2}
  \pgfmathsetmacro{\s}{\k}
  % \pgfmathsetmacro{\n}{(\R - 1) * \k/\d}
  % \pgfmathsetmacro{\ell}{\k/\d}
  % \pgfmathsetmacro{\ellPlusN}{\ell + \n}
  \begin{tikzpicture}[trim axis left,
    declare function={
    	eps(\a) = 1 - 2 * \a;
    	tau(\eps) = \eps^3 * (1 - \eps) * log2(exp(1)) * \k;
    	%----------- Praos beacon----------------
    	phi(\eps) = (3/2) * (1 + \eps)^(1/3) * ( 1 - \eps)^(2/3);
    	praos_delta(\a) = 0.5 - 0.5 * (
    		log2(\s^2 * 2^(-1.3 + 1.85 * eps(\a))  ) 
    		+ \s * log2( 
	    		\a > 1/3 ? ((5 - 3 * eps(\a))/2) : (
	    		\a > 0.2 ? (2^(2/3) * phi(eps(\a))) : (
	    		\a > 0.0955 ? ((5/3) * phi(eps(\a))) : 	(1)
			) ) ) )/tau(eps(\a));
    	%----------- New beacon ----------------
			moment(\a) = 
				\a <= 0.41 
				? (1 + 3 * \a + \a^2)
				: 1/\a;
			lambda(\a) = 
				\a <= 0.41 
				? 2 
				: 2 * ln(1/\a) / ln(1 + 3 * \a + \a * \a);
			n(\a) = tau(eps(\a)) / log2(1/\a);
			ell(\a) = n(\a) / (\R-1);
      f(\a) = 2 / lambda(\a);
      %
      new_beacon_delta(\a) = 
				1 - 1/lambda(\a) 
					- (
						ell(\a)/lambda(\a) * log2( moment(\a) )
			      + (1 + 1/lambda(\a)) * log2( n(\a) )
		    	)/tau(eps(\a));
		  % new_beacon_delta(\a) = 
      % 	1 - 1/lambda(\a) - ( 
      % 		( ell(\a) / lambda(\a) ) * log2(	moment(\a) ) 
		    % 		+ (1 + 1/lambda(\a) )  * log2( n(\a) ) 
      % 	)/ tau(eps(\a));
    }
    %    declare function = { entropy(\x) = 1; },
    ]
    \begin{axis}[domain=0:0.5,
      restrict x to domain=0:0.41,
      xmin=0, xmax=0.5,
      samples=100,
      enlarge x limits=false,
      grid=both,
      no markers,
      % ymin=0,
      % ymax=1,
      % x label style={at={(axis description cs:0.5,-0.1)},anchor=north},
      % y label style={at={(axis description cs:0,.5)},anchor=south},
      xlabel={$\alpha$, relative adversarial stake},
      ylabel={$\delta$},
      % there is one default value for the `legend pos' that is outside the axis
      legend pos=outer north east,
      % (so the legend looks a bit better)
      legend cell align=left
      ]
      % \addplot +[thick,domain=0:(0.0955),red,forget plot] plot (\x, {rho_praos_small_alpha(\x)});
      % \addplot +[thick,domain=0.0955:(1/3),red,forget plot] plot (\x, {rho_praos_mid_alpha(\x)});
      % \addplot +[thick,domain=(1/3):(0.5),red,legend] plot (\x, {rho_praos_large_alpha(\x)});
      % \addlegendentry{Praos, $\ellPlusN$ rounds}

      % \addplot +[thick,domain=0:(1/3),blue,forget plot] plot (\x, {rho_geom_small_alpha(\x)});
      % \addplot +[thick,domain=(1/3):(1/2),blue,legend] plot (\x, {rho_geom_large_alpha(\x)});
      % \addlegendentry{$(\ell, \n, \alpha)$-geometric game, $d = 1$}

      \addplot +[thick,domain=(0.001):(0.41),blue] plot (\x, {new_beacon_delta(\x)});
      \addlegendentry{New beacon}

      % \addplot +[thick,domain=(0):(1/2),red] plot (\x, {praos_delta(\x});
      % \addlegendentry{Praos beacon, $s = k$}

    \end{axis}
  \end{tikzpicture}
  \caption{Plot of $\delta$ from~\eqref{eq:delta-prob-loss-multiepoch} using $k = 900, T = 24k, s = k/4,$ and $\EpsP = 2^{-k/3}$.}
  \label{fig:poisson-beacon}
\end{figure}

% } % end iftoggle{drawfigs}




\section{Proof of Theorem~\ref{thm:beacon-poisson}}
	% Suppose $\Pi$ is $(p, \rho)$-secure. 
	% Since the ledger protocol $\Blockchain$ is $(2^{-\tau}, k)$-secure, 
	% Lemma~\ref{prop:coin-tossing-security-private} states that 
	% $\rho$ is given by~\eqref{eq:minentropy-loss-poisson} 
	% where we use $\EpsP = 2^{-\tau}$. 
	% It also states that 
	% $p = \alpha^n + 2 \cdot 2^{-\tau} \leq 3 \cdot 2^{-\tau}$ 
	% since $\alpha^n \leq 2^{-\tau}$. 
	% Next, Lemma~\ref{lemma:composition} states that 
	% an $(L, \Pi)$-composition must be $(2^\rho p L, \rho)$-secure.

	Let $\ell = k/d$ and $n = (T - k)/d$. 
	Let $\tau = \log_2(1/\EpsP)$. 
	Let $a = 1 + 3 \alpha + \alpha^2$
	% $$
 %    a = 
 %      % \begin{cases}
 %        1 + 3 \alpha + \alpha^2 &\quad\text{if $\alpha \leq 0.41$\,,} \\
 %        1/\alpha &\quad\text{otherwise\,,}
 %    \end{cases}
	% $$
	and 
	$$
		p(d) = n^{1+1/\lambda} \EpsP^{1 - 1/\lambda} a^{\ell/\lambda}
		\,.
	$$
	Then, according to Lemma~\ref{lemma:composition}, 
  the min-entropy loss is at most $\log_2(\gamma)$ 
  except with probability at most $3 L p(d)$.	
	Let $\delta \in (0, 1)$ so that $p(d) \leq \EpsP^\delta$; 
	the value of $\delta$ will be determined later. 
	We wish to select a $d$ so that $\delta$ is maximized.

	First, we require that 
	\begin{align*}
		&\alpha^n \leq \EpsP\,,\\
		\text{or}\quad &
			1/\EpsP \leq (1/\alpha)^{(T - k)/d}\,,\\
		\text{or}\quad &
			\log_2(1/\EpsP) \leq ((T - k)/d)\log_2(1/\alpha)\,,\\
		\text{or}\quad &
			d \leq \dMax \triangleq \frac{(T - k)\log_2(1/\alpha)}{\log_2(1/\EpsP)}
			\,.
	\end{align*}

	We also want 
	\begin{align*}
		&p(d) \leq \EpsP^{\delta}\,,\\
		\text{or}\quad &
			n^{1+1/\lambda} \EpsP^{1 - 1/\lambda} a^{\ell/\lambda} \leq \EpsP^\delta \,,\\
		\text{or}\quad &
			(1+1/\lambda)\log_2(n)
			+ (1/\lambda - 1)\log_2(1/\EpsP) 
			+ (\ell/\lambda) \log_2(a) \leq -\delta \log_2(1/\EpsP) \,,\\
		\text{or}\quad &			
			(\ell/\lambda) \log_2(a) \leq (1-\delta - 1/\lambda) \log_2(1/\EpsP) - (1+1/\lambda)\log_2(n)\,,\\
		\text{or}\quad &			
			(k/d\lambda) \log_2(a) \leq (1-\delta - 1/\lambda) \log_2(1/\EpsP) - (1+1/\lambda)\log_2((T-k)/d)\,,\\
		\text{or}\quad &			
			\frac{(k/\lambda) \log_2(a)}{(1-\delta - 1/\lambda) \log_2(1/\EpsP) - (1+1/\lambda)\log_2((T-k)/d)} \leq d
			\,.
	\end{align*}
	
	For the above inequality to hold, 
	it suffices to take $d \geq \dMin(\delta)$ where 
	$$
		\dMin(\delta) = \frac{(k/\lambda) \log_2 a}{(1 - \delta - 1/\lambda) \log_2(1/\EpsP) - (1+1/\lambda) \log_2(T - k)}
		\,.
	$$
	An admissible $d$ must satisfy
	\begin{align*}
		&\dMin(\delta) \leq \dMax	\,,\\
		\text{or}\quad &			
			\frac{(k/\lambda) \log_2 a}{(1 - \delta - 1/\lambda) \log_2(1/\EpsP) - (1+1/\lambda) \log_2(T - k)}
				\leq (T - k) \log_2(1/\alpha)/\log_2(1/\EpsP) \,,\\
		\text{or}\quad &			
			\frac{(k/\lambda) \log_2 a}{(T - k) \log_2(1/\alpha)/\log_2(1/\EpsP)} 
				\leq (1 - \delta - 1/\lambda) \log_2(1/\EpsP) - (1+1/\lambda) \log_2(T - k) \,,\\
    \text{or}\quad &      
      \frac{(k/\lambda) \log_2 a}{(T - k) \log_2(1/\alpha)} + \frac{(1+1/\lambda) \log_2(T - k)}{\log_2(1/\EpsP)}
        \leq 1 - \delta - 1/\lambda  \,,\\
    \text{or}\quad &      
      \frac{k}{T-k}\cdot \frac{f(\alpha)}{\lambda} + (1+1/\lambda) \frac{ \log_2(T - k)}{\log_2(1/\EpsP)}
        \leq 1 - \delta - 1/\lambda  \,,
  %       \\
		% \text{or}\quad &			
		% 	\frac{(1/\lambda) \log_2 a}{(R - 1) \log_2(1/\alpha)} + \frac{(1+1/\lambda) \log_2(k(R-1))}{\log_2(1/\EpsP)}
		% 		\leq 1 - \delta - 1/\lambda  
				\,.
	\end{align*}
  where we used $f(\alpha) = \log_2(a)/\log_2(1/\alpha)$. 
	Thus, if we take $d = \lfloor \dMax \rfloor$, we can achieve  $p(d) \leq \EpsP^{\delta}$ 
	where 
	\begin{align}
		\delta
			% &\leq \leq 1 - 1/\lambda - \frac{(1/\lambda) \log_2 a}{(R-1) \log_2(1/\alpha)} - \frac{(1+1/\lambda) \log_2(k(R-1))}{\log_2(1/\EpsP)}  \\
      &\leq 1 - 1/\lambda - \frac{k}{T-k}\cdot \frac{f(\alpha)}{\lambda} - (1+1/\lambda) \frac{ \log_2(T - k)}{\log_2(1/\EpsP)}\,. \label{eq:delta}    
	\end{align}


  \begin{fact*}
    If $x,y \in \RR$ satisfy $y = x^{-1/\log_2(1/x)}$ then $y = 2$.
  \end{fact*}
  \noindent
  For further simplification, let us use the assumption that $\alpha \leq 0.41$ 
  and write $c = k/(T-k)$; 
  this implies $\lambda = 2, a = 1 + \alpha + \alpha^2$, 
  \begin{align*}
    \delta
      &\leq \frac{1}{2} - \frac{c f(\alpha)}{2} - \frac{3}{2} \frac{ \log_2(T - k)}{\log_2(1/\EpsP)}\,, 
      \qquad \text{and}\\
    \EpsP^\delta  
      &\leq \EpsP^{1/2 - c f(\alpha)/2} \cdot \left[ \EpsP^{-1/\log_2(1/\EpsP)} \right]^{(3/2)\log_2(T - k)} \\
      &= \EpsP^{1/2 - c f(\alpha)/2} \cdot 2^{(3/2)\log_2(T - k)} \\
      &= \EpsP^{1/2 - (k/(T-k)) f(\alpha)/2} \cdot (T - k)^{3/2} 
      \,,
  \end{align*}
  as claimed in the theorem statement. 
  Here, we used the above fact with $x = \EpsP$.

	\hfill\qed





% %--------------------------------------------------------------
% % \begin{theorem}[Composing $(\ell, n, \alpha)$-Bernoulli games]\label{thm:xor-game-beacon}
% % 	Let $\EpsP, \delta \in (0,1), \alpha \in (0, 1/2)$, 
% % 	and $L, \kappa \in \NN$ be arbitrary parameters. 
% % 	Set $q = \log_2(1/\EpsP)$, 
% % 	$\lambda = \log_2(1/\alpha)$, 
% % 	$n = q/\lambda$,  
% % 	$\ell \leq q(1 - \delta - 1/\lambda) - (3 + \log_2 n)$,
% % 	% $\ell \leq q(1 - \delta - 1/\lambda) - 3 - \log_2(q/\lambda)$,
% % 	and $N = \ell + n$.
% % 	Consider an $(L, N, \kappa)$-composition (cf. Definition~\ref{def:composition}) 
% % 	of the $(\ell, n, \alpha)$-Bernoulli game  
% % 	with a uniformly random value. 
% % 	The min-entropy of this composition 
% % 	is at least $\kappa - \left(\ell + 1 + n + \log_2(n) \right)$, 
% % 	except with probability at most $\EpsP^\delta$. 
% % 	% In particular, $\delta \in (0,1)$ if $\ell < q - 3 - n - \log_2(L n)$.
% % \end{theorem}
% % \begin{proof}
% % 	First, we claim that the prerequisite $\EpsA \leq \EpsP$ 
% % 	in the Composition Lemma (Lemma~\ref{lemma:composition}) holds. 
% % 	This is because (i.) $\EpsA = \alpha^{n+\ell} \leq \alpha^n$ by 
% % 	the independence of the Bernoulli random variables $Z_i$s, and 
% % 	(ii.) setting $n = q/\lambda$ implies $\alpha^n = \EpsP$.  

% % 	Next, observe that the expression of $\delta$ in~\eqref{eq:delta-composition-generic} stays the same 
% % 	even if we use the base-$2$ logarithm instead of the natural logarithm. 
% % 	In addition, notice that $1/\lambda = n/q$ by design and 
% % 	$(1/\lambda) \log_2 \Exp g^\lambda = \ell + 1 + (\log_2(n))/\lambda$ 
% % 	by Lemma~\ref{lemma:xor-game-bernoulli-moment}.
% % 	By the Composition Lemma, the error probability is at most $L \EpsP^{\delta^\prime}$ 
% % 	where
% % 	$\delta^\prime = 1 - (n + \ell + 1 + \log_2(3 n)/\lambda)/q$. 
% % 	It is easy to see that $\delta^\prime < 1$.
% % 	Since $\alpha < 1/2$, we have $\lambda > 1$ and consequently, we can take
% % 	$\hat{\delta} = 1 - (n + \ell + 1 + \log_2(3 n))/q < \delta^\prime < 1$. 
% % 	This choice implies $\EpsP^{\hat{\delta}}$ is an upper bound on the failure probability $\EpsP^{\delta^\prime}$. 

% % 	However, we can change the order of choosing $\hat{\delta}$ and $\ell$. 
% % 	Namely, the above choice of $\hat{\delta}$ and $\ell$ is equivalent to first choosing 
% % 	an arbitrary $\delta \in (0, 1)$ and then choosing an $\ell \in \NN$, 
% % 	as a function of $n, q$, and $\delta$, 
% % 	satisfying $\ell \leq q(1 - \delta) - (n + \log_2(3 n) + 1)$. 
% % 	It follows that the failure probability $\EpsP^{\delta^\prime}$ is at most $\EpsP^\delta$. 
% % 	This bound on $\ell$ means it suffices to take 
% % 	$\ell \leq  q(1 - \delta - 1/\lambda) - (3 + \log_2(n))$ 
% % 	since $n = q/\lambda$ and $1 + \log_2(3) < 3$.

% % 	The min-entropy bound in the claim follows from using the expression of $\gamma$ from
% % 	Lemma~\ref{lemma:xor-game-bernoulli-gamma} 
% % 	into Corollary~\ref{coro:composition-min-entropy}. 
% % \end{proof}


% \subsection{Min-entropy of a composition of \texorpdfstring{$(\ell, n, \alpha)$-}{}geometric games}
% \begin{theorem}[Composing $(\ell, n, \alpha)$-geometric games]\label{thm:xor-game-beacon-geometric}
% 	Let $\EpsP, \delta \in (0,1), \alpha \in (0, 1/2)$, 
% 	and $L, \kappa \in \NN$ be arbitrary parameters. 
% 	Define $\beta = \beta(\alpha)$ and $c = c(\alpha)$ as
% 	\[
% 		\begin{cases}
% 			\beta = 1/2,\, c = \sqrt{e}
% 				\,,&\qquad\text{if}\quad \alpha \in (0, 1/4]\,, \\
% 			\beta = 2/3,\, c = 0.85
% 				\,,&\qquad\text{if}\quad \alpha \in (1/4, 1/3]\,, \\
% 			\beta = 5/(12 - 14 \alpha),\, c = (1.67 + 2.66 \alpha)/3^\beta
% 				\,,&\qquad\text{if}\quad \alpha \in (1/3, 1/2)\,.
% 		\end{cases}
% 	\]	
% 	Set
% 	% $\lambda = \log_2(1/\alpha)$, 
% 	\begin{align*}
% 		q = \log_2(1/\EpsP)\,, \quad 
% 		n = \frac{q}{\log_2(1/\alpha)}\,,\quad\text{and}\quad
% 		\ell \leq
% 			\frac{q(1 - \beta - \delta ) - \log_2(3 n 5^\beta)}{\log_2(c) - \log_2(1-\alpha)}
% 			\,.
% 	\end{align*}
% 	% $\ell \leq q(1 - \delta - 1/\lambda) - 3 - \log_2(q/\lambda)$,
% 	Let $U$ be an $(\ell, n, \alpha)$-geometric game 
% 	on strings in $\{0,1\}^\kappa$. 
% 	With probability at least $1 - L \EpsP^\delta$,
% 	the min-entropy loss in 
% 	an $(L, G)$-composition 
% 	% (cf. Definition~\ref{def:composition}) 
% 	is at most 
% 	\[
% 		\beta q + \ell \log_2\left( c / (1 - \alpha)\right) + \log_2(n 5^\beta)
% 		\,.
% 	\]
% \end{theorem}

% \begin{proof}
% 	First, we claim that the prerequisite $\Pr[A_1] \leq \EpsP$ 
% 	in Lemma~\ref{lemma:composition} holds. 
% 	Let $X \sim \GeomAlpha$ and recall that 
% 	the size of an option set is stochastically dominated by $X$.
% 	Since $\Pr[X \geq 2] = \alpha$, the probability that 
% 	each of $n$ independent copies of $X$ is at least two, 
% 	is $\alpha^n$. 
% 	Since $n = q/\log_2(1/\alpha)$ by design, 
% 	it follows that $\alpha^n = \EpsP$.  

% 	The remainder of the proof is similar to 
% 	the proof of Theorem~\ref{thm:xor-game-beacon-bernoulli}. 
% 	The only variation is that we take $\gamma$ from~\eqref{eq:xor-geom-tail-gamma}.	
% \end{proof}







